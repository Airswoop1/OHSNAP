<!DOCTYPE html>
<html>
<head>
    <title>Capture Signature for PDF</title>
    <!--<script src="js/sig/signature_pad.js"></script>-->
    <link rel="stylesheet" href="css/sig_style.css"/>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <!--[if lt IE 9]>
    <script type="text/javascript" src="js/sig/flashcanvas.js"></script>
    <![endif]-->
    <script src="js/sig/jSignature.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=3">

</head>
<body>
<div class="page_container" >
    <div id="header">
        <h4>Sign application</h4>
    </div>
    <div class="top-container">
        <p>Thank you for your recent application for SNAP! To submit your application, you need to sign it in 2 places. Tap the button below to begin.</p>
        <div class="yellow-button" id="ready2sign">I'm ready to sign</div>
    </div>

    <div class="img_container">
        <img src="" alt=""/>
        <div id="sig_container1">
            <div id="sig_capture1"></div>

            <div id="sig_prompt1">
                Sign in the box with your finger.
                <div id="sig_continue" class="sig_button">
                    Continue
                </div>
            </div>
        </div>
    </div>
    <div class="img_container">
        <img src="" alt=""/>
    </div>
    <div class="img_container">
        <img src="" alt=""/>
    </div>
    <div class="img_container" id="sig2img_container">
        <img src="" alt=""/>
        <div id="sig_container2">
            <div id="sig_capture2"></div>

            <div class="sig_prompt">
                Sign in the box with your finger.
                <div class="sig_button" id="submit_application">
                    Submit application
                </div>
            </div>


        </div>


    </div>

</div>




<script>

    var user_id = window.location.search.substring(1).split("=")[1];
    if(typeof user_id == 'undefined'){
        alert("Something went wrong, please go back and tap on the link again.")
    }

    var data = {
        'user_id': user_id,
        'sig1': undefined,
        'sig2' : undefined
    };


    $('.img_container > img').each(function(index){
        console.log("setting src for image")

        $(this).attr("src", "/images/sig/" + user_id + "_" + (index+1) + ".jpg");
    });


    $(document).ready(function() {


        var jsig1 = $("#sig_capture1").jSignature({'UndoButton':true}),
            jsig2 = undefined;

        jsig1.jSignature("reset");

        document.getElementById('ready2sign').addEventListener("click", goToSign1);
        document.getElementById('sig_continue').addEventListener("click", goToSign2);
        document.getElementById('submit_application').addEventListener("click", goToConfirmation);

        function goToSign1() {
            document.getElementById('sig_container1').scrollIntoView(true);
        }

        function goToSign2() {

            data.sig1 = jsig1.jSignature('getData');
            jsig2 = $('#sig_capture2').jSignature({'UndoButton':true});

            document.getElementById('sig_container2').scrollIntoView(true);
            document.getElementById('sig2img_container').scrollLeft = 168;
        }

        function goToConfirmation() {
            data.sig2 = jsig2.jSignature("getData");

            if(typeof data.sig1 === 'undefined' || typeof data.sig2 === 'undefined'){
                alert("Signatures are required to submit your application.");
            }
            else {
                sendDataToServer();
            }

        }

        function sendDataToServer() {

            $.ajax('/send_sig_data',{
                "type": "POST",
                "data": data
            })
            .done(function(html){
                  console.log(html);
                  alert('DOne!');
                  //window.location.href = "/sig_completed.html";
            })
        }


    });

</script>



</body>
</html>